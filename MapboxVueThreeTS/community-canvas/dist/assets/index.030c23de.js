import{openBlock as p,createElementBlock as m,defineComponent as j,ref as U,normalizeClass as I,createElementVNode as c,createTextVNode as _,toDisplayString as h,unref as a,Fragment as f,createCommentVNode as M,renderList as N,pushScopeId as P,popScopeId as A,resolveComponent as $,createVNode as k,createApp as B}from"../node_modules/vue/dist/vue.runtime.esm-bundler.js";import{defineStore as z,storeToRefs as b,createPinia as F}from"../node_modules/pinia/dist/pinia.mjs";import*as D from"mapbox-gl";import{Map as E}from"mapbox-gl";import{Threebox as V}from"../node_modules/threebox-plugin/main.js";import{S3Client as J,ListObjectsV2Command as K}from"../node_modules/@aws-sdk/client-s3/dist-es/index.js";import y from"../node_modules/aws-sdk/lib/browser.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();window.global||(window.global=window);const Z="pk.eyJ1IjoibWFzaGl5YXQiLCJhIjoiY2x1MzdxZzV4MHQ4bDJqbzN2aDNuazB2MiJ9.9hN3i429a3wstWUHA45bfg",S=z("location",{state:()=>({lng:-73.8892669226548,lat:40.753826358076516,bearing:0,pitch:60,zoom:20})}),w=z("urlList",{state:()=>({urls:new Array,modelURL:null}),actions:{RetrieveModelURL(n){let t=this.urls[n];t.split("Thumbnails/")[1].split("/")[0]==="Trees"?this.modelURL=t.split("Thumbnails/").join("").split(".png").join("").concat(".glb"):this.modelURL=t.split("Thumbnails/").join("").split(".png").join("").concat(".gltf")}}}),G=async()=>{const n=new K({Bucket:"community-canvas-bucket",Prefix:"CCModels/Thumbnails/",MaxKeys:100});try{let t=!0;console.log(`Your bucket contains the following objects:
`);let s="";const r="https://community-canvas-bucket.s3.amazonaws.com/",e=w(),{urls:o}=b(e);for(;t;){const{Contents:i,IsTruncated:d,NextContinuationToken:u}=await W.send(n);i.map(g=>{e.$patch({urls:o.value.concat(r+g.Key)}),s+=`${r+g.Key}
`}),t=d,n.input.ContinuationToken=u}}catch(t){console.error(t)}},L=new y.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:5d854e3e-4399-4452-91b0-178ee7f8c110"},{region:"us-east-1",httpOptions:{timeout:1e3}}),W=new J({region:"us-east-1",credentials:L});L.get(n=>{n?console.error("Error getting credentials:",n):(console.log("Success!"),y.config.credentials=L,console.log(y.config.credentials),G())});Object.getOwnPropertyDescriptor(D,"accessToken").set(Z);class Y{createCustomLayer(t,s){return{id:t,type:"custom",renderingMode:"3d",onAdd:function(e,o){window.tb=new V(e,e.getCanvas().getContext("webgl"),{enableSelectingObjects:!0,enableDraggingObjects:!0,enableRotatingObjects:!0,enableTooltips:!1})},render:function(e,o){window.tb.update()}}}constructor(t){let s=[-73.8892669226548,40.753826358076516],r;t.on("style.load",()=>{t.setConfigProperty("basemap","lightPreset","dusk"),r=this.createCustomLayer("3d-model",s),t.addLayer(r),window.tb.defaultLights();const e=w(),{modelURL:o}=b(e);t.on("click",i=>{if(o.value===null)return;let d={type:"gltf",obj:o.value,units:"meters",scale:.3,rotation:{x:90,y:0,z:0},anchor:"center"};window.tb.loadObj(d,u=>{u.setCoords([i.lngLat.lng,i.lngLat.lat]),window.tb.add(u,r.id),window.tb.lights.dirLight.target=u,window.tb.update()}),e.$patch({modelURL:null})})})}}const q={data:()=>({map:null}),mounted(){const n=S(),t=new E({container:"mapContainer",style:"mapbox://styles/mapbox/standard",zoom:20,center:[-73.8892669226548,40.753826358076516],pitch:60,antialias:!0}),s=()=>{n.$patch(this.getLocation())};t.on("move",s),t.on("zoom",s),t.on("rotate",s),t.on("pitch",s),n.$subscribe((r,e)=>{const o=this.getLocation(),i=this.map;(o.lng!=e.lng||o.lat!=e.lat)&&i.setCenter({lng:e.lng,lat:e.lat}),o.pitch!=e.pitch&&i.setPitch(e.pitch),o.bearing!=e.bearing&&i.setBearing(e.bearing),o.zoom!=e.zoom&&i.setZoom(e.zoom)}),this.map=t,new Y(this.map)},unmounted(){this.map!=null&&(this.map.remove(),this.map=null)},methods:{getLocation(){return{...this.map.getCenter(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),zoom:this.map.getZoom()}}}};const v=(n,t)=>{const s=n.__vccOpts||n;for(const[r,e]of t)s[r]=e;return s},H={id:"mapContainer",ref:"mapContainer",class:"map-container"};function Q(n,t,s,r,e,o){return p(),m("div",H,null,512)}const X=v(q,[["render",Q]]),ee=""+new URL("LOGO.c2c9fe9a.png",import.meta.url).href,l=n=>(P("data-v-9f7b5cbe"),n=n(),A(),n),te=l(()=>c("div",{class:"logo"},[c("img",{src:ee,alt:"Community Canvas logo"})],-1)),oe=l(()=>c("span",{class:"material-symbols-outlined"},"keyboard_double_arrow_right",-1)),ne=[oe],se={id:"sidebar"},ie=l(()=>c("br",null,null,-1)),re=l(()=>c("br",null,null,-1)),ce=l(()=>c("br",null,null,-1)),ae=l(()=>c("br",null,null,-1)),le=l(()=>c("br",null,null,-1)),de=l(()=>c("h3",{class:"menu-title"},"Models",-1)),ue={class:"menu-content"},pe={class:"model-menu"},me=["onClick"],ge=["src"],_e=j({__name:"SideMenu",setup(n){const t=S(),s=w(),{lat:r,lng:e,bearing:o,pitch:i,zoom:d}=b(t),{urls:u}=b(s),g=U(!1),R=()=>{g.value=!g.value};return(ve,C)=>(p(),m("aside",{class:I(`${g.value?"isExpanded":""}`)},[te,c("div",{class:"menu-toggle-wrap"},[c("button",{class:"menu-toggle",onClick:R},ne)]),c("div",se,[_(" Longitude: "+h(a(e).toFixed(4))+" ",1),ie,_(" Latitude: "+h(a(r).toFixed(4))+" ",1),re,_(" Zoom: "+h(a(d).toFixed(2))+" ",1),ce,a(o)?(p(),m(f,{key:0},[_(" Bearing: "+h(a(o).toFixed(2))+" ",1),ae],64)):M("",!0),a(i)?(p(),m(f,{key:1},[_(" Pitch: "+h(a(i).toFixed(2))+" ",1),le],64)):M("",!0),c("button",{onClick:C[0]||(C[0]=x=>a(t).$patch({lng:-73.8892669226548,lat:40.753826358076516,bearing:0,pitch:60,zoom:20}))},"Reset Camera")]),de,c("div",ue,[c("div",pe,[(p(!0),m(f,null,N(a(u),(x,T)=>(p(),m("button",{class:"model-image-button",onClick:Ce=>a(s).RetrieveModelURL(T)},[c("img",{src:x,alt:"no image"},null,8,ge)],8,me))),256))])])],2))}});const he=v(_e,[["__scopeId","data-v-9f7b5cbe"]]);const fe={components:{Map:X,SideMenu:he}},be={id:"layout"};function ye(n,t,s,r,e,o){const i=$("SideMenu"),d=$("Map");return p(),m(f,null,[k(i),c("div",be,[k(d)])],64)}const Le=v(fe,[["render",ye]]);const we=F(),O=B(Le);O.use(we);O.mount("#app");
//# sourceMappingURL=index.030c23de.js.map
